<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm Soát Đơn Hàng</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        input, button {
            padding: 10px;
            margin: 5px;
        }
        .summary {
            margin-top: 20px;
            padding: 10px;
            background-color: #e0f7fa;
        }
    </style>
</head>
<body>

<h1>Kiểm Soát Đơn Hàng</h1>

<!-- Form nhập thông tin đơn hàng -->
<form id="orderForm">
    <label for="workerName">Tên Người Làm:</label>
    <input type="text" id="workerName" required>

    <label for="orderDate">Ngày:</label>
    <input type="date" id="orderDate" required>
    
    <label for="orderAmount">Mã Tiền:</label>
    <input type="text" id="orderAmount" required placeholder="Ví dụ: 10, 20, 30">

    <button type="submit">Thêm Mã Tiền</button>
</form>

<!-- Hiển thị hoá đơn của người làm -->
<h3>Hoá Đơn của Người Làm: <span id="currentWorkerName">Chưa chọn người làm</span></h3>
<table id="ordersTable">
    <thead>
        <tr>
            <th>Ngày</th>
            <th>Mã Tiền</th>
            <th>Tổng Tiền</th>
            <th>Hành Động</th>
        </tr>
    </thead>
    <tbody>
        <!-- Dữ liệu đơn hàng sẽ được thêm vào đây -->
    </tbody>
</table>

<!-- Tính tổng tiền của người làm -->
<div class="summary">
    <h3>Tổng Tiền Của Người Làm:</h3>
    <p id="totalAmountDisplay">0 VND</p>
</div>

<script>
    // Dữ liệu đơn hàng
    let orders = [];
    let currentWorker = ''; // Biến lưu trữ tên người làm hiện tại

    // Xử lý sự kiện khi nhập tên người làm
    document.getElementById('workerName').addEventListener('input', function() {
        currentWorker = document.getElementById('workerName').value;
        document.getElementById('currentWorkerName').textContent = currentWorker || "Chưa chọn người làm";
        updateOrdersTable(); // Cập nhật lại bảng khi chọn người làm
        updateTotalAmount();  // Cập nhật tổng tiền sau khi thay đổi tên
    });

    // Xử lý sự kiện thêm mã tiền
    document.getElementById('orderForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Ngừng hành động mặc định của form

        const orderDate = document.getElementById('orderDate').value;
        const orderAmountInput = document.getElementById('orderAmount').value;

        // Tách các mã tiền bằng dấu phẩy và tính tổng
        const amounts = orderAmountInput.split(',').map(amount => parseFloat(amount.trim())).filter(amount => !isNaN(amount));
        const totalAmount = amounts.reduce((sum, amount) => sum + amount, 0);

        if (currentWorker && orderDate && totalAmount > 0) {
            // Thêm mã tiền vào danh sách đơn hàng
            const newOrder = { worker: currentWorker, date: orderDate, amounts, totalAmount };
            orders.push(newOrder);

            // Cập nhật bảng và tổng tiền
            updateOrdersTable();
            updateTotalAmount();
        } else {
            alert("Vui lòng nhập mã tiền hợp lệ.");
        }
    });

    // Cập nhật bảng hoá đơn của người làm
    function updateOrdersTable() {
        const tableBody = document.getElementById('ordersTable').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // Xóa tất cả các dòng trước khi cập nhật

        // Lọc đơn hàng theo người làm hiện tại
        const workerOrders = orders.filter(order => order.worker === currentWorker);

        // Nếu có đơn hàng thì hiển thị, nếu không thì không làm gì
        if (workerOrders.length > 0) {
            workerOrders.forEach((order, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.date}</td>
                    <td>${order.amounts.join(', ')}</td>
                    <td>${formatCurrency(order.totalAmount * 1000)}</td>
                    <td><button onclick="deleteOrder(${index})">Xóa</button></td>
                `;
                tableBody.appendChild(row);
            });
        } else {
            // Nếu không có đơn hàng cho người làm, chỉ hiển thị thông báo
            const row = document.createElement('tr');
            row.innerHTML = `<td colspan="4">Không có đơn hàng cho người làm này.</td>`;
            tableBody.appendChild(row);
        }
    }

    // Xóa đơn hàng
    function deleteOrder(index) {
        // Xóa đơn hàng khỏi danh sách
        orders.splice(index, 1);

        // Cập nhật lại bảng và tổng tiền
        updateOrdersTable();
        updateTotalAmount();
    }

    // Cập nhật tổng tiền của người làm
    function updateTotalAmount() {
        // Lọc đơn hàng theo người làm hiện tại
        const workerOrders = orders.filter(order => order.worker === currentWorker);

        // Tính tổng tiền
        const totalAmount = workerOrders.reduce((sum, order) => sum + order.totalAmount, 0);
        const totalAmountInVND = totalAmount * 1000; // Chuyển thành VND

        // Hiển thị tổng tiền
        document.getElementById('totalAmountDisplay').textContent = formatCurrency(totalAmountInVND);
    }

    // Hàm định dạng tiền tệ với dấu phẩy và thêm chữ "VND"
    function formatCurrency(amount) {
        return amount.toLocaleString() + " VND"; // Sử dụng phương thức toLocaleString và thêm "VND"
    }
</script>

</body>
</html>
